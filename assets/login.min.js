/*global json err websocket*/

let socket = new WebSocket(websocket+"/anon")
socket.onerror = function (e) { err("Something wrong has happened with the back of the server. Please DM the administrators on discord.") }
socket.onclose = function (e) { err("Something wrong has happened with the server. Please DM the admins on discord.") }
let x = 0;
function auth () {
  socket.onmessage = function (e) {
    let data = JSON.parse(e.data)
    if(data.ok == false) {
      switch (data.msg) {
        case "CONF_EMAIL":
          inf("You can't be logged in unless you confirm your email.")
        break;
        case "INC_DATA":
        if (x <= 3) {
          err("Your username or password is incorrect.")
          x++
        } else {
          err("Your username or password is incorrect.<br>Need a <a href='#' onclick='reset'>change</a>?")
        }
      }
    }
    socket.send(JSON.stringify({
    cmd: "authenticate",
    data: {
      username: document.getElementById("un").value.toLowerCase(),
      password: document.getElementById("pw").value
    }
  }))
}
}

function reset () {
  if (document.getElementById("un").value === undefined) {
    err("There's no username.")
    return;
  }
  socket.onmessage = function (e) {
    let data = JSON.parse(e.data)
    if (data.ok === false) {
      err("Something is wrong. Try again.")
    } else {
      inf('An email has been sent to your account regarding the password reset.')
    }
  }
  socket.send(JSON.stringify({
    cmd: "reset",
    data: document.getElementById("un").value.toLowerCase()
  }))
}